!function i(r,a,l){function u(t,e){if(!a[t]){if(!r[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(c)return c(t,!0);var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}var s=a[t]={exports:{}};r[t][0].call(s.exports,function(e){return u(r[t][1][e]||e)},s,s.exports,i,r,a,l)}return a[t].exports}for(var c="function"==typeof require&&require,e=0;e<l.length;e++)u(l[e]);return u}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Build={version:"6.22.19 (5571198f515709ee6898e89a25b33091704ed1be)",wasmSize:2167869,jsSize:472944}},{}],2:[function(e,t,n){"use strict";var o=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}();Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function i(e,t,n){var o=this;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.storeName="files",this.version=e,this.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,this.indexedDB){var s=this.indexedDB.open("gpx-bigstorage ("+e+")",1);s.onerror=function(e){n("Can't open cache database")},s.onsuccess=function(e){o.db=s.result,t(o)},s.onupgradeneeded=function(e){try{o.db=s.result,o.db.onerror=function(e){n("Can't upgrade cache database")},o.db.createObjectStore(o.storeName)}catch(e){n("Can't upgrade cache database")}}}else n("Indexed db is not supported on this host")}return o(i,[{key:"put",value:function(e,t,n){var o=this.db.transaction(this.storeName,"readwrite");o.oncomplete=function(){return n()},o.objectStore(this.storeName).put(t,e)}},{key:"get",value:function(e,t,n){var o=this.db.transaction(this.storeName,"readonly").objectStore(this.storeName).get(e);o.onerror=function(){return n("Can't read value for key '"+e+"'")},o.onsuccess=function(){o.result?t(o.result):n("Result is empty for key '"+e+"', result: "+o.result)}}},{key:"forEach",value:function(n,o){var e=this,t=this.db.transaction(this.storeName,"readonly").objectStore(this.storeName).openCursor();t.onerror=function(){return onerror("Can't open cursor on "+e.storeName)},t.onsuccess=function(e){var t=e.target.result;t?(n(t.key.toString(),t.value),t.continue()):o()}}}]),i}();n.default=s},{}],3:[function(e,t,n){"use strict";var o=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}();Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return o(e,[{key:"put",value:function(e,t,n){}},{key:"get",value:function(e,t,n){n("Cache is not supported on this host")}},{key:"forEach",value:function(e,t){t()}}]),e}();n.default=s},{}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=e("./js-dos-cache-db"),s=e("./js-dos-cache-noop");n.default=function(t,n){new o.default(t.version,n,function(e){t.log("ERR! Can't initalize cache, cause: "+e),n(new s.default)})}},{"./js-dos-cache-db":2,"./js-dos-cache-noop":3}],5:[function(e,t,n){"use strict";var o=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}();Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function n(e,t){var s=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.shellInputQueue=[],this.shellInputClients=[],this.dos=e,this.em=e,this.api=e,this.api.ping=function(e){for(var t=arguments.length,n=Array(1<t?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];s.onping(e,n)},this.onready=t}return o(n,[{key:"width",value:function(){return this.dos.canvas.width}},{key:"height",value:function(){return this.dos.canvas.height}},{key:"shell",value:function(){for(var l=this,e=arguments.length,u=Array(e),t=0;t<e;t++)u[t]=arguments[t];if(0!==u.length)return new Promise(function(e,t){l.shellInputClients.push(e);var n=!0,o=!1,s=void 0;try{for(var i,r=u[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var a=i.value;l.shellInputQueue.push(a)}}catch(e){o=!0,s=e}finally{try{!n&&r.return&&r.return()}finally{if(o)throw s}}l.requestShellInput()})}},{key:"screenshot",value:function(){var e=this;return new Promise(function(t){e.api.send("screenshot","",function(e){t(e)})})}},{key:"exit",value:function(){try{this.dos.terminate(),this.api.send("exit")}catch(e){return 0}return this.dos.error("Runtime is still alive!"),-1}},{key:"sendKeyPress",value:function(e){this.api.send("sdl_key_event",e+"")}},{key:"requestShellInput",value:function(){this.sendKeyPress(13)}},{key:"onping",value:function(e,t){switch(e){case"ready":this.onready(this);break;case"frame":this.onframe();break;case"shell_input":if(0===this.shellInputQueue.length)return;var n=t[0],o=t[1],s=this.shellInputQueue.shift(),i=this.em.lengthBytesUTF8(s)+1;if(o<i)return void this.dos.onerror("Can't execute cmd '"+s+"', because it's bigger then max cmd length "+o);if(this.em.stringToUTF8(s,n,i),0===this.shellInputQueue.length){var r=!0,a=!1,l=void 0;try{for(var u,c=this.shellInputClients[Symbol.iterator]();!(r=(u=c.next()).done);r=!0){(0,u.value)()}}catch(e){a=!0,l=e}finally{try{!r&&c.return&&c.return()}finally{if(a)throw l}}this.shellInputClients=[]}else this.requestShellInput()}}},{key:"onframe",value:function(){this.dos.tick()}}]),n}();n.DosCommandInterface=s},{}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.jsdosconf="\n# This is the configurationfile for DOSBox 0.74. (Please use the latest version of DOSBox)\n# Lines starting with a # are commentlines and are ignored by DOSBox.\n# They are used to (briefly) document the effect of each option.\n\n[sdl]\n#       fullscreen: Start dosbox directly in fullscreen. (Press ALT-Enter to go back)\n#       fulldouble: Use double buffering in fullscreen. It can reduce screen flickering, but it can also result in a slow DOSBox.\n#   fullresolution: What resolution to use for fullscreen: original or fixed size (e.g. 1024x768).\n#                     Using your monitor's native resolution with aspect=true might give the best results.\n#                     If you end up with small window on a large screen, try an output different from surface.\n# windowresolution: Scale the window to this size IF the output device supports hardware scaling.\n#                     (output=surface does not!)\n#           output: What video system to use for output.\n#                   Possible values: surface, overlay, opengl, openglnb.\n#         autolock: Mouse will automatically lock, if you click on the screen. (Press CTRL-F10 to unlock)\n#      sensitivity: Mouse sensitivity.\n#      waitonerror: Wait before closing the console if dosbox has an error.\n#         priority: Priority levels for dosbox. Second entry behind the comma is for when dosbox is not focused/minimized.\n#                     pause is only valid for the second entry.\n#                   Possible values: lowest, lower, normal, higher, highest, pause.\n#       mapperfile: File used to load/save the key/event mappings from. Resetmapper only works with the defaul value.\n#     usescancodes: Avoid usage of symkeys, might not work on all operating systems.\n\nfullscreen=false\nfulldouble=false\nfullresolution=original\nwindowresolution=original\noutput=surface\nautolock=false\nsensitivity=100\nwaitonerror=true\npriority=higher,normal\nmapperfile=mapper-jsdos.map\nusescancodes=true\nvsync=false\n\n[dosbox]\n# language: Select another language file.\n#  machine: The type of machine tries to emulate.\n#           Possible values: hercules, cga, tandy, pcjr, ega, vgaonly, svga_s3, svga_et3000, svga_et4000, svga_paradise, vesa_nolfb, vesa_oldvbe.\n# captures: Directory where things like wave, midi, screenshot get captured.\n#  memsize: Amount of memory DOSBox has in megabytes.\n#             This value is best left at its default to avoid problems with some games,\n#             though few games might require a higher value.\n#             There is generally no speed advantage when raising this value.\n\nlanguage=\nmachine=svga_s3\ncaptures=capture\nmemsize=16\n\n[render]\n# frameskip: How many frames DOSBox skips before drawing one.\n#    aspect: Do aspect correction, if your output method doesn't support scaling this can slow things down!.\n#    scaler: Scaler used to enlarge/enhance low resolution modes.\n#              If 'forced' is appended, then the scaler will be used even if the result might not be desired.\n#            Possible values: none, normal2x, normal3x, advmame2x, advmame3x, advinterp2x, advinterp3x, hq2x, hq3x, 2xsai, super2xsai, supereagle, tv2x, tv3x, rgb2x, rgb3x, scan2x, scan3x.\n\nframeskip=0\naspect=false\nscaler=normal2x\n\n[cpu]\n#      core: CPU Core used in emulation. auto will switch to dynamic if available and appropriate.\n#            Possible values: auto, dynamic, normal, simple.\n#   cputype: CPU Type used in emulation. auto is the fastest choice.\n#            Possible values: auto, 386, 386_slow, 486_slow, pentium_slow, 386_prefetch.\n#    cycles: Amount of instructions DOSBox tries to emulate each millisecond.\n#            Setting this value too high results in sound dropouts and lags.\n#            Cycles can be set in 3 ways:\n#              'auto'          tries to guess what a game needs.\n#                              It usually works, but can fail for certain games.\n#              'fixed #number' will set a fixed amount of cycles. This is what you usually need if 'auto' fails.\n#                              (Example: fixed 4000).\n#              'max'           will allocate as much cycles as your computer is able to handle.\n#\n#            Possible values: auto, fixed, max.\n#   cycleup: Amount of cycles to decrease/increase with keycombo.(CTRL-F11/CTRL-F12)\n# cycledown: Setting it lower than 100 will be a percentage.\n\ncore=auto\ncputype=auto\ncycles=auto\ncycleup=10\ncycledown=20\n\n[mixer]\n#   nosound: Enable silent mode, sound is still emulated though.\n#      rate: Mixer sample rate, setting any device's rate higher than this will probably lower their sound quality.\n#            Possible values: 44100, 48000, 32000, 22050, 16000, 11025, 8000, 49716.\n# blocksize: Mixer block size, larger blocks might help sound stuttering but sound will also be more lagged.\n#            Possible values: 1024, 2048, 4096, 8192, 512, 256.\n# prebuffer: How many milliseconds of data to keep on top of the blocksize.\n\nnosound=false\nrate=44100\nblocksize=1024\nprebuffer=20\n\n[midi]\n#     mpu401: Type of MPU-401 to emulate.\n#             Possible values: intelligent, uart, none.\n# mididevice: Device that will receive the MIDI data from MPU-401.\n#             Possible values: default, win32, alsa, oss, coreaudio, coremidi, none.\n# midiconfig: Special configuration options for the device driver. This is usually the id of the device you want to use.\n#               See the README/Manual for more details.\n\nmpu401=intelligent\nmididevice=default\nmidiconfig=\n\n[sblaster]\n#  sbtype: Type of Soundblaster to emulate. gb is Gameblaster.\n#          Possible values: sb1, sb2, sbpro1, sbpro2, sb16, gb, none.\n#  sbbase: The IO address of the soundblaster.\n#          Possible values: 220, 240, 260, 280, 2a0, 2c0, 2e0, 300.\n#     irq: The IRQ number of the soundblaster.\n#          Possible values: 7, 5, 3, 9, 10, 11, 12.\n#     dma: The DMA number of the soundblaster.\n#          Possible values: 1, 5, 0, 3, 6, 7.\n#    hdma: The High DMA number of the soundblaster.\n#          Possible values: 1, 5, 0, 3, 6, 7.\n# sbmixer: Allow the soundblaster mixer to modify the DOSBox mixer.\n# oplmode: Type of OPL emulation. On 'auto' the mode is determined by sblaster type. All OPL modes are Adlib-compatible, except for 'cms'.\n#          Possible values: auto, cms, opl2, dualopl2, opl3, none.\n#  oplemu: Provider for the OPL emulation. compat might provide better quality (see oplrate as well).\n#          Possible values: default, compat, fast.\n# oplrate: Sample rate of OPL music emulation. Use 49716 for highest quality (set the mixer rate accordingly).\n#          Possible values: 44100, 49716, 48000, 32000, 22050, 16000, 11025, 8000.\n\nsbtype=sb16\nsbbase=220\nirq=7\ndma=1\nhdma=5\nsbmixer=true\noplmode=auto\noplemu=default\noplrate=44100\n\n[gus]\n#      gus: Enable the Gravis Ultrasound emulation.\n#  gusrate: Sample rate of Ultrasound emulation.\n#           Possible values: 44100, 48000, 32000, 22050, 16000, 11025, 8000, 49716.\n#  gusbase: The IO base address of the Gravis Ultrasound.\n#           Possible values: 240, 220, 260, 280, 2a0, 2c0, 2e0, 300.\n#   gusirq: The IRQ number of the Gravis Ultrasound.\n#           Possible values: 5, 3, 7, 9, 10, 11, 12.\n#   gusdma: The DMA channel of the Gravis Ultrasound.\n#           Possible values: 3, 0, 1, 5, 6, 7.\n# ultradir: Path to Ultrasound directory. In this directory\n#           there should be a MIDI directory that contains\n#           the patch files for GUS playback. Patch sets used\n#           with Timidity should work fine.\n\ngus=false\ngusrate=44100\ngusbase=240\ngusirq=5\ngusdma=3\nultradir=C:ULTRASND\n\n[speaker]\n# pcspeaker: Enable PC-Speaker emulation.\n#    pcrate: Sample rate of the PC-Speaker sound generation.\n#            Possible values: 44100, 48000, 32000, 22050, 16000, 11025, 8000, 49716.\n#     tandy: Enable Tandy Sound System emulation. For 'auto', emulation is present only if machine is set to 'tandy'.\n#            Possible values: auto, on, off.\n# tandyrate: Sample rate of the Tandy 3-Voice generation.\n#            Possible values: 44100, 48000, 32000, 22050, 16000, 11025, 8000, 49716.\n#    disney: Enable Disney Sound Source emulation. (Covox Voice Master and Speech Thing compatible).\n\npcspeaker=true\npcrate=44100\ntandy=auto\ntandyrate=44100\ndisney=true\n\n[joystick]\n# joysticktype: Type of joystick to emulate: auto (default), none,\n#               2axis (supports two joysticks),\n#               4axis (supports one joystick, first joystick used),\n#               4axis_2 (supports one joystick, second joystick used),\n#               fcs (Thrustmaster), ch (CH Flightstick).\n#               none disables joystick emulation.\n#               auto chooses emulation depending on real joystick(s).\n#               (Remember to reset dosbox's mapperfile if you saved it earlier)\n#               Possible values: auto, 2axis, 4axis, 4axis_2, fcs, ch, none.\n#        timed: enable timed intervals for axis. Experiment with this option, if your joystick drifts (away).\n#     autofire: continuously fires as long as you keep the button pressed.\n#       swap34: swap the 3rd and the 4th axis. can be useful for certain joysticks.\n#   buttonwrap: enable button wrapping at the number of emulated buttons.\n\njoysticktype=auto\ntimed=true\nautofire=false\nswap34=false\nbuttonwrap=false\n\n[serial]\n# serial1: set type of device connected to com port.\n#          Can be disabled, dummy, modem, nullmodem, directserial.\n#          Additional parameters must be in the same line in the form of\n#          parameter:value. Parameter for all types is irq (optional).\n#          for directserial: realport (required), rxdelay (optional).\n#                           (realport:COM1 realport:ttyS0).\n#          for modem: listenport (optional).\n#          for nullmodem: server, rxdelay, txdelay, telnet, usedtr,\n#                         transparent, port, inhsocket (all optional).\n#          Example: serial1=modem listenport:5000\n#          Possible values: dummy, disabled, modem, nullmodem, directserial.\n# serial2: see serial1\n#          Possible values: dummy, disabled, modem, nullmodem, directserial.\n# serial3: see serial1\n#          Possible values: dummy, disabled, modem, nullmodem, directserial.\n# serial4: see serial1\n#          Possible values: dummy, disabled, modem, nullmodem, directserial.\n\nserial1=dummy\nserial2=dummy\nserial3=disabled\nserial4=disabled\n\n[dos]\n#            xms: Enable XMS support.\n#            ems: Enable EMS support.\n#            umb: Enable UMB support.\n# keyboardlayout: Language code of the keyboard layout (or none).\n\nxms=true\nems=true\numb=true\nkeyboardlayout=auto\n\n[ipx]\n# ipx: Enable ipx over UDP/IP emulation.\n\nipx=false\n\n[autoexec]\n# Lines in this section will be run at startup.\n# You can put your MOUNT lines here.\n\n# https://js-dos.com\n# █▀▀▀▀▀█ █  ▄▄▄▀▀█ █▀▀▀▀▀█\n# █ ███ █ ██▄ █ ▀ ▄ █ ███ █\n# █ ▀▀▀ █ ▄██ ▀ ▀▀█ █ ▀▀▀ █\n# ▀▀▀▀▀▀▀ ▀ █▄▀▄▀ █ ▀▀▀▀▀▀▀\n# █▀▄▄█▀▀▄▄ ▀ ▀█▄▄▄▄ ▀▄█▀█▀\n# █▀ ▀ ▀▀▄ █▀ ▄ ▄▀▀▀▄ █▀█▄\n# ▄ ▄▄ █▀▀▄ ▄▀▄▀▀█  ▀▀▄▀▀█▀\n#   ▄▀▀█▀▀ █▀█▀█▀▀▄ ▀██▀█▄\n# ▀▀▀ ▀ ▀ █▄█ ▀█▄▄█▀▀▀█▀▀\n# █▀▀▀▀▀█ ▄▄▄ ▄ ▄ █ ▀ █▄▄▄▄\n# █ ███ █ ▀█▀▀▄▀▀▄████▀▀█▄█\n# █ ▀▀▀ █ ▄▀▀█▀█▀▄ ▀▀▄▄█▄█ \n# ▀▀▀▀▀▀▀ ▀   ▀▀ ▀  ▀   ▀▀▀\n"},{}],7:[function(e,t,n){"use strict";var o=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}();Object.defineProperty(n,"__esModule",{value:!0});var l=e("./js-dos-cache-noop"),u=e("./js-dos-xhr"),s=function(){function n(e){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.syncingPromise=null,this.lastSyncTime=0,this.dos=e,this.em=e,this.fs=e.FS,this.dos.registerTickListener(function(){Date.now()-t.lastSyncTime<5e3||(t.lastSyncTime=Date.now(),t.syncFs())}),this.dos.registerPauseListener(function(){return t.syncFs()}),this.dos.registerTerminateListener(function(){return t.syncFs()})}return o(n,[{key:"chdir",value:function(e){this.fs.chdir(e)}},{key:"extract",value:function(n){var r=this,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"/",e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"zip",t=(a=this.normalizePath(a)).split("/");this.createPath(t,0,t.length),this.chdir(a);var o=function(){return new Promise(function(s,i){"zip"===e?new u.Xhr(n,{cache:new l.default,responseType:"arraybuffer",fail:function(e){return i(e)},progress:function(e,t){return r.dos.onprogress("Downloading "+n,e,t)},success:function(e){var t=new Uint8Array(e),n=r.em._malloc(t.length);r.em.HEAPU8.set(t,n);var o=r.em._extract_zip(n,t.length);r.em._free(n),0===o?(r.writeOk(a),r.syncFs().then(s).catch(i)):i("Can't extract zip, retcode "+o+", see more info in logs")}}):i("Only ZIP archive is supported")})};return"/"===a||0===a.length?o():new Promise(function(t,n){0<r.lastSyncTime?n("Can't create persistent mount point, after syncing process starts"):(r.fs.mount(r.fs.filesystems.IDBFS,{},a),r.fs.syncfs(!0,function(e){if(!e)return r.readOk(a)?void t():(r.dos.warn("Indexed db contains broken FS, resetting..."),void o().then(t).catch(n));n("Can't restore FS from indexed db, cause: "+e)}))})}},{key:"createFile",value:function(e,t){t instanceof ArrayBuffer&&(t=new Uint8Array(t));var n=(e=e.replace(new RegExp("^[a-zA-z]+:"),"").replace(new RegExp("\\\\","g"),"/")).split("/");if(0!==n.length){var o=n[n.length-1].trim();if(0!==o.length){var s=this.createPath(n,0,n.length-1);this.fs.createDataFile(s,o,t,!0,!0,!0)}else this.dos.onerror("Can't create file '"+e+"', because file name is empty")}else this.dos.onerror("Can't create file '"+e+"', because it's not valid file path")}},{key:"createPath",value:function(e,t,n){for(var o="",s=t;s<n;++s){var i=e[s].trim();0!==i.length&&(this.fs.createPath(o,i,!0,!0),o=o+"/"+i)}return o}},{key:"syncFs",value:function(){var s=this;return this.syncingPromise||(this.syncingPromise=new Promise(function(t,n){var o=Date.now();s.fs.syncfs(!1,function(e){e&&(s.dos.error("Can't sync FS to indexed db, cause: "+e),n(e)),s.syncingPromise=null,s.lastSyncTime=Date.now(),t(),console.log("========++> FS SYNCED, ms: "+(Date.now()-o))})})),this.syncingPromise}},{key:"normalizePath",value:function(e){return 0!==e.length&&"/"===e[0]||(e="/"+e),1<e.length&&e.endsWith("/")&&(e=e.substr(0,e.length-1)),e}},{key:"readOk",value:function(e){try{var t=this.fs.readFile(e+"/state.fs");return 79===t[0]&&70===t[1]}catch(e){return!1}}},{key:"writeOk",value:function(e){this.createFile(e+"/state.fs",new Uint8Array([79,70]))}}]),n}();n.DosFS=s},{"./js-dos-cache-noop":3,"./js-dos-xhr":12}],8:[function(e,t,n){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}();Object.defineProperty(n,"__esModule",{value:!0});var d=e("./js-dos-build"),f=e("./js-dos-xhr"),i=function(){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.wasmSupported=!1,this.global=window,this.wdosboxPromise=null,this.global.exports={};try{if("object"===("undefined"==typeof WebAssembly?"undefined":o(WebAssembly))&&"function"==typeof WebAssembly.instantiate&&"function"==typeof WebAssembly.compile){var e=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));e instanceof WebAssembly.Module&&(this.wasmSupported=new WebAssembly.Instance(e)instanceof WebAssembly.Instance)}}catch(e){}this.polyfill()}return s(t,[{key:"polyfill",value:function(){Math.imul&&-5===Math.imul(4294967295,5)||(Math.imul=function(e,t){var n=65535&e,o=65535&t;return n*o+((e>>>16)*o+n*(t>>>16)<<16)|0}),Math.imul=Math.imul,Math.fround||(Math.fround=function(e){return e}),Math.fround=Math.fround,Math.clz32||(Math.clz32=function(e){e>>>=0;for(var t=0;t<32;t++)if(e&1<<31-t)return t;return 32}),Math.clz32=Math.clz32,Math.trunc||(Math.trunc=function(e){return e<0?Math.ceil(e):Math.floor(e)}),Math.trunc=Math.trunc}},{key:"resolveDosBox",value:function(e,t,n){var o=this;this.global.exports.WDOSBOX?n.ondosbox(this.global.exports.WDOSBOX,this.global.exports.instantiateWasm):this.wasmSupported?(null===this.wdosboxPromise&&(this.wdosboxPromise=this.compileDosBox(e,t,n)),this.wdosboxPromise.then(function(e){setTimeout(function(){o.wdosboxPromise=null,n.ondosbox(o.global.exports.WDOSBOX,o.global.exports.instantiateWasm)},1)},function(e){setTimeout(function(){o.wdosboxPromise=null,n.onerror(e)},1)})):n.onerror("WebAssembly is not supported, can't resolve wdosbox")}},{key:"compileDosBox",value:function(r,a,l){var u=this,c=d.Build.wasmSize+d.Build.jsSize;return new Promise(function(s,i){var e=r.replace(".js",".wasm.js");new f.Xhr(e,{cache:a,responseType:"arraybuffer",progress:function(e,t){l.onprogress&&l.onprogress("Resolving DosBox",c,t)},fail:function(e,t,n){i("Can't download wasm, code: "+t+", message: "+n+", url: "+e)},success:function(e){var t=WebAssembly.compile(e),o=function(e){i(e+"")};t.catch(o),t.then(function(n){u.global.exports.instantiateWasm=function(e,t){return WebAssembly.instantiate(n,e).catch(o).then(function(e){t(e,n)})},new f.Xhr(r,{cache:a,progress:function(e,t){l.onprogress&&l.onprogress("Resolving DosBox",c,d.Build.wasmSize+t)},fail:function(e,t,n){i("Can't download wdosbox.js, code: "+t+", message: "+n+", url: "+e)},success:function(e){l.onprogress("Resolving DosBox",c,c),e+=eval.call(window,e),s(u.global.exports.WDOSBOX)}})})}})})}}]),t}();n.Host=new i},{"./js-dos-build":1,"./js-dos-xhr":12}],9:[function(e,t,n){"use strict";var s=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}();Object.defineProperty(n,"__esModule",{value:!0});var i=e("./js-dos-build"),r=e("./js-dos-ci"),a=e("./js-dos-conf"),l=e("./js-dos-fs"),u=e("./js-dos-options"),c=e("./js-dos-ui"),o=function(e){function o(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(o.__proto__||Object.getPrototypeOf(o)).call(this));return n.isValid=!1,n.canvas=null,n.version=i.Build.version,n.ci=null,n.fs=null,n.ui=null,n.tickListeners=[],n.pauseListeners=[],n.resumeListeners=[],n.terminateListeners=[],n.canvas=e,n.onready=t,n.registerDefaultListeners(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(o,u.DosOptions),s(o,[{key:"registerDefaultListeners",value:function(){var e=this,t=void 0,n=void 0;void 0!==document.hidden?(t="hidden",n="visibilitychange"):void 0!==document.mozHidden?(t="mozHidden",n="mozvisibilitychange"):void 0!==document.msHidden?(t="msHidden",n="msvisibilitychange"):void 0!==document.webkitHidden&&(t="webkitHidden",n="webkitvisibilitychange"),document.addEventListener(n,function(){document[t]?e.pause():e.resume()},!1),window.addEventListener("beforeunload",function(){e.terminate()})}},{key:"debug",value:function(e){this.log("[DEBUG] "+e)}},{key:"info",value:function(e){this.log("[INFO] "+e)}},{key:"warn",value:function(e){this.log("[WARN] "+e)}},{key:"error",value:function(e){this.log("[ERROR] "+e)}},{key:"ondosbox",value:function(e,t){this.info("DosBox resolved"),this.instantiateWasm=t,this.instance=new e(this)}},{key:"resolve",value:function(){var o=this;this.wdosboxUrl||(this.wdosboxUrl="wdosbox.js"),this.log||(this.log=function(e){return console.log(e)}),this.canvas?(this.onprogress||(this.ui=new c.DosUi(this),this.onprogress=function(e,t,n){return o.ui.onprogress(e,t,n)}),this.SDL={defaults:{widht:320,height:200,copyOnLock:!1,discardOnLock:!0,opaqueFrontBuffer:!1}},this.isValid=!0):this.onerror("canvas field is required, but not set!")}},{key:"onRuntimeInitialized",value:function(){var n=this;this.fs=new l.DosFS(this),this.onready({fs:this.fs,main:function(e){return null!==n.ui&&(n.ui.detach(),n.ui=null),e||(e=[]),n.fs.chdir("/"),n.fs.createFile("/home/web_user/.dosbox/dosbox-jsdos.conf",a.jsdosconf),e.unshift("-userconf","-c","mount c .","-c","c:"),n.callMain(e),new Promise(function(t){new r.DosCommandInterface(n,function(e){t(e)})})}})}},{key:"registerTickListener",value:function(e){this.tickListeners.push(e)}},{key:"registerPauseListener",value:function(e){this.pauseListeners.push(e)}},{key:"registerResumeListener",value:function(e){this.resumeListeners.push(e)}},{key:"registerTerminateListener",value:function(e){this.terminateListeners.push(e)}},{key:"tick",value:function(){var e=!0,t=!1,n=void 0;try{for(var o,s=this.tickListeners[Symbol.iterator]();!(e=(o=s.next()).done);e=!0){(0,o.value)()}}catch(e){t=!0,n=e}finally{try{!e&&s.return&&s.return()}finally{if(t)throw n}}}},{key:"pause",value:function(){var e=!0,t=!1,n=void 0;try{for(var o,s=this.pauseListeners[Symbol.iterator]();!(e=(o=s.next()).done);e=!0){(0,o.value)()}}catch(e){t=!0,n=e}finally{try{!e&&s.return&&s.return()}finally{if(t)throw n}}}},{key:"resume",value:function(){var e=!0,t=!1,n=void 0;try{for(var o,s=this.resumeListeners[Symbol.iterator]();!(e=(o=s.next()).done);e=!0){(0,o.value)()}}catch(e){t=!0,n=e}finally{try{!e&&s.return&&s.return()}finally{if(t)throw n}}}},{key:"terminate",value:function(){var e=!0,t=!1,n=void 0;try{for(var o,s=this.terminateListeners[Symbol.iterator]();!(e=(o=s.next()).done);e=!0){(0,o.value)()}}catch(e){t=!0,n=e}finally{try{!e&&s.return&&s.return()}finally{if(t)throw n}}}}]),o}();n.DosModule=o},{"./js-dos-build":1,"./js-dos-ci":5,"./js-dos-conf":6,"./js-dos-fs":7,"./js-dos-options":10,"./js-dos-ui":11}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.DosOptions=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}},{}],11:[function(e,t,n){"use strict";var o=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}();Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function i(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.css='\n    .dosbox-container { position: relative; min-width: 320px; min-height: 200px; display: inline-block; }\n    .dosbox-overlay, .dosbox-loader { position: absolute; left: 0; right: 0; top: 0; bottom: 0; background-color: rgba(51, 51, 51, 0.7); }\n    .dosbox-start { text-align: center; position: absolute; left: 0; right: 0; bottom: 50%; color: #f80; font-size: 1.5em; text-decoration: underline; cursor: pointer; }\n    .dosbox-overlay a { color: #f80; }\n    .dosbox-powered { position: absolute; right: 1em; bottom: 1em; font-size: 0.8em; color: #9C9C9C; }\n    .dosbox-loader-message { text-align: center; position: absolute; left: 0; right: 0; bottom: 50%; margin: 0 0 -3em 0; box-sizing: border-box; color: #f80; font-size: 1.5em; }\n    @-moz-keyframes loading { 0% { left: 0; } 50% { left: 8.33333em; } 100% { left: 0; } } @-webkit-keyframes loading { 0% { left: 0; } 50% { left: 8.33333em; } 100% { left: 0; } } @keyframes loading { 0% { left: 0; } 50% { left: 8.33333em; } 100% { left: 0; } } .st-loader { width: 10em; height: 2.5em; position: absolute; top: 50%; left: 50%; margin: -1.25em 0 0 -5em; box-sizing: border-box; }\n    .st-loader:before, .st-loader:after { content: ""; display: block; position: absolute; top: 0; bottom: 0; width: 1.25em; box-sizing: border-box; border: 0.25em solid #f80; }\n    .st-loader:before { left: -0.76923em; border-right: 0; }\n    .st-loader:after { right: -0.76923em; border-left: 0; }\n    .st-loader .equal { display: block; position: absolute; top: 50%; margin-top: -0.5em; left: 4.16667em; height: 1em; width: 1.66667em; border: 0.25em solid #f80; box-sizing: border-box; border-width: 0.25em 0; -moz-animation: loading 1.5s infinite ease-in-out; -webkit-animation: loading 1.5s infinite ease-in-out; animation: loading 1.5s infinite ease-in-out; background: #f80; }\n    ',this.overlayHtml='\n        <div class="dosbox-loader">\n            <div class="st-loader">\n                <span class="equal"></span>\n            </div>\n            <div class="dosbox-loader-message"></div>\n        </div>\n        <div class="dosbox-powered">\n            Powered by &nbsp;<a href="https://js-dos.com">js-dos.com</a> (6.22)\n        </div>\n    ',this.dos=e,this.canvas=e.canvas;try{if(null===document.getElementById("js-dos-ui-css")){var t=document.createElement("style");t.id="js-dos-ui-css",t.innerHTML=this.css,document.head.appendChild(t)}if("dosbox-container"!==this.canvas.parentElement.className){var n=document.createElement("div");n.className="dosbox-container",this.canvas.parentElement.replaceChild(n,this.canvas),n.appendChild(this.canvas);var o=document.createElement("div");o.className="dosbox-overlay",n.appendChild(o),o.innerHTML=this.overlayHtml}var s=this.canvas.parentElement;this.overlay=this.childById(s,"dosbox-overlay"),this.loaderMessage=this.childById(this.overlay,"dosbox-loader-message"),this.hidden=!0,this.show()}catch(e){this.onprogress=this.onprogressFallback}}return o(i,[{key:"onprogress",value:function(e,t,n){var o=e+" "+Math.round(100*n/t*10)/10+"%";this.loaderMessage.innerHTML=o,this.dos.info(o),t<=n?this.hide():this.show()}},{key:"detach",value:function(){this.hide(),this.onprogress=this.onprogressFallback}},{key:"hide",value:function(){this.hidden||(this.hidden=!0,this.overlay.setAttribute("style","display: none"))}},{key:"show",value:function(){this.hidden&&(this.hidden=!1,this.overlay.setAttribute("style","display: block"))}},{key:"onprogressFallback",value:function(e,t,n){this.dos.info(e+" "+100*n/t+"%")}},{key:"childById",value:function(e,t){if(null===e)return null;for(var n=0;n<e.childElementCount;++n){var o=e.children[n];if(o.className===t)return o;if(null!==(o=this.childById(o,t)))return o}return null}}]),i}();n.DosUi=s},{}],12:[function(e,t,n){"use strict";var s=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}();Object.defineProperty(n,"__esModule",{value:!0});var i=e("./js-dos-cache-noop"),o=function(){function o(e,t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.total=0,this.loaded=0,this.resource=e,this.options=t,this.options.method=t.method||"GET",this.cache=t.cache||new i.default,"GET"===this.options.method&&this.cache.get(this.resource,function(e){n.options.success(e)},function(){n.makeHttpRequest()})}return s(o,[{key:"makeHttpRequest",value:function(){var t=this;this.xhr=new XMLHttpRequest,this.xhr.open(this.options.method,this.resource,!0),"POST"===this.options.method&&this.xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded"),this.xhr.overrideMimeType("text/plain; charset=x-user-defined");var e=void 0;"function"==typeof(e=this.xhr).addEventListener&&e.addEventListener("progress",function(e){if(t.total=e.total,t.loaded=e.loaded,t.options.progress)return t.options.progress(e.total,e.loaded)});var n=void 0;"function"==typeof(n=this.xhr).addEventListener&&n.addEventListener("error",function(e){if(t.options.fail)return t.options.fail(t.resource,t.xhr.status,"connection problem"),delete t.options.fail}),this.xhr.onreadystatechange=function(){return t.onReadyStateChange()},this.options.responseType&&(this.xhr.responseType=this.options.responseType),this.xhr.send(this.options.data)}},{key:"onReadyStateChange",value:function(){if(4===this.xhr.readyState)if(200===this.xhr.status){if(this.options.success){var e=Math.max(this.total,this.loaded);return this.options.progress(e,e),"GET"===this.options.method&&this.resource.indexOf("?")<0&&this.cache.put(this.resource,this.xhr.response,function(){}),this.options.success(this.xhr.response)}}else if(this.options.fail)return this.options.fail(this.resource,this.xhr.status,"connection problem"),delete this.options.fail}}]),o}();n.Xhr=o},{"./js-dos-cache-noop":3}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./js-dos-cache"),a=e("./js-dos-host"),l=e("./js-dos-module");function o(s,i){var e=new Promise(function(e,t){var n=new l.DosModule(s,e);i||(i={}),i.onerror||(i.onerror=function(e){console.error(e)}),Object.assign(n,i);var o=n.onerror;n.onerror=function(e){t(e);setTimeout(function(){n.onerror=o?(o(e),o):n.error},1)},n.resolve(),n.isValid&&r.default(n,function(e){a.Host.resolveDosBox(n.wdosboxUrl,e,n)})});return e.ready=function(t){return e.then(function(e){t(e.fs,e.main)}),e},e}n.Dos=o,window.Dos=o},{"./js-dos-cache":4,"./js-dos-host":8,"./js-dos-module":9}]},{},[13]);
//# sourceMappingURL=js-dos.js.map
